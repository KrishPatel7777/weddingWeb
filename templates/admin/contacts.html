<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Enquiries - Admin Panel</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/admin.css') }}">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Parampara</h2>
                <p>Admin Panel</p>
            </div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('admin_dashboard') }}" class="nav-link">
                    <span class="icon">ðŸ“Š</span> Dashboard
                </a>
                <a href="{{ url_for('admin_contacts') }}" class="nav-link active">
                    <span class="icon">ðŸ“‹</span> Contact Enquiries
                </a>
                <a href="{{ url_for('admin_logout') }}" class="nav-link logout">
                    <span class="icon">ðŸšª</span> Logout
                </a>
            </nav>
            <div class="sidebar-footer">
                <p>Welcome, {{ session.admin_username }}</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>Contact Enquiries</h1>
                <div class="header-actions">
                    <span class="total-count">Total: {{ contacts|length }}</span>
                </div>
            </header>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Filters -->
            <div class="filters-bar">
                <div class="filter-group">
                    <label>Status:</label>
                    <select onchange="window.location.href='?status=' + this.value + '&sort={{ sort_by }}'">
                        <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All</option>
                        <option value="new" {% if status_filter == 'new' %}selected{% endif %}>New Only</option>
                        <option value="contacted" {% if status_filter == 'contacted' %}selected{% endif %}>Contacted</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort by:</label>
                    <select onchange="window.location.href='?status={{ status_filter }}&sort=' + this.value">
                        <option value="latest" {% if sort_by == 'latest' %}selected{% endif %}>Latest First</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>Oldest First</option>
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name (A-Z)</option>
                    </select>
                </div>
            </div>

            <!-- Contacts Table -->
            <div class="card">
                <div class="table-responsive">
                    <table class="data-table contacts-table">
                        <thead>
                            <tr>
                                <th>Full Name</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Event Date</th>
                                <th>City</th>
                                <th>Event Type</th>
                                <th>Guests</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Submitted</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if contacts %}
                                {% for contact in contacts %}
                                    <tr class="contact-row {% if contact.status == 'contacted' %}contacted{% endif %}">
                                        <td data-label="Full Name"><strong>{{ contact.fullName }}</strong></td>
                                        <td data-label="Phone">{{ contact.phone }}</td>
                                        <td data-label="Email">{{ contact.email or 'N/A' }}</td>
                                        <td data-label="Event Date">{{ contact.eventDate }}</td>
                                        <td data-label="City">{{ contact.eventCity }}</td>
                                        <td data-label="Event Type">
                                            <span class="event-tag">{{ contact.eventType }}</span>
                                        </td>
                                        <td data-label="Guests">{{ contact.guestCount }}</td>
                                        <td data-label="Description" class="description-cell"
                                            onclick="this.classList.toggle('expanded')">
                                            {{ contact.description }}
                                        </td>
                                        <td data-label="Status">
                                            <span class="badge badge-{{ 'success' if contact.status == 'contacted' else 'warning' }}">
                                                {{ contact.status|default('new')|title }}
                                            </span>
                                        </td>
                                        <td data-label="Submitted">
                                            {% if contact.created_at %}
                                                {{ contact.created_at.strftime('%d %b %Y, %H:%M') }}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </td>
                                        <td data-label="Actions">
                                            <div class="action-buttons">
                                                {% if contact.status != 'contacted' %}
                                                    <form method="POST" action="{{ url_for('mark_contacted', contact_id=contact._id) }}">
                                                        <button type="submit" class="btn-action btn-success">âœ“</button>
                                                    </form>
                                                {% else %}
                                                    <form method="POST" action="{{ url_for('mark_new', contact_id=contact._id) }}">
                                                        <button type="submit" class="btn-action btn-warning">â†º</button>
                                                    </form>
                                                {% endif %}
                                                <form method="POST" action="{{ url_for('delete_contact', contact_id=contact._id) }}">
                                                    <button type="submit" class="btn-action btn-danger">Ã—</button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="11" class="no-data">No enquiries found</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Confirm delete action
        document.querySelectorAll('.btn-danger').forEach(btn => {
            btn.closest('form').addEventListener('submit', function(e) {
                if (!confirm('Are you sure you want to delete this enquiry? This action cannot be undone.')) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>